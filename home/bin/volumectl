#!/usr/bin/env bash
# Dunst-aware pamixer volume control.
#
# Usage:
# $ volumectl up
# $ volumectl down
# $ volumectl mute
#
# Inspired by https://gist.github.com/sebastiencs/5d7227f388d93374cebdf72e783fbd6a

# Default values, feel free to override here or via environment variables
: "${NOTIFY_ID:=2593}"
: "${NOTIFY_TIMEOUT:=1500}"
: "${NOTIFY_ICON:notification-audio-volume-medium}"
: "${NOTIFY_ICON_MUTED:notification-audio-volume-muted}"
: "${NOTIFY_CATEGORY:audio}"

notify() {
	declare icon="${1:-$NOTIFY_ICON}" body="${2:-"Volume"}"
	notify-send \
		--category="${NOTIFY_CATEGORY}" \
		--expire-time="${NOTIFY_TIMEOUT}" \
		--icon="${icon}" \
		--hint="int:value:$(pamixer --get-volume)" \
		"$body"
}

main() {
	set -eo pipefail; [[ "$TRACE" ]] && set -x

	declare cmd="$1"

	case ${cmd} in
	up)
		pamixer --increase 5
		pamixer -u # Force unmute
		notify
		;;
	down)
		pamixer --decrease 5
		pamixer -u # Force unmute
		notify
		;;
	mute)
		pamixer --toggle-mute
		if $(pamixer --get-mute > /dev/null); then
			notify "${NOTIFY_ICON_MUTED}" "Mute"
		else
			notify
		fi
		;;
	esac
}

main "$@"
